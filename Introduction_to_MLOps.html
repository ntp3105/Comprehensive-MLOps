<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>introduction-to-mlops</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Introduction to MLOps_files/libs/clipboard/clipboard.min.js"></script>
<script src="Introduction to MLOps_files/libs/quarto-html/quarto.js"></script>
<script src="Introduction to MLOps_files/libs/quarto-html/popper.min.js"></script>
<script src="Introduction to MLOps_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Introduction to MLOps_files/libs/quarto-html/anchor.min.js"></script>
<link href="Introduction to MLOps_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Introduction to MLOps_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Introduction to MLOps_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Introduction to MLOps_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Introduction to MLOps_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="mlops-machine-learning-operations" class="level1">
<h1><span style="color:darkblue"><strong>MLOps</strong></span>: [<span style="color:darkblue"><strong>M</strong></span>]achine [<span style="color:darkblue"><strong>L</strong></span>]earning [<span style="color:darkblue"><strong>Op</strong></span>]eration[<span style="color:darkblue"><strong>s</strong></span>]</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>MLOps, short for Machine Learning Operations, is an emerging practice and implementing tools focused on streamlining and automating the lifecycle management of machine learning models. It borrows various principles from cross-domains, meaning, the continuous integration and continuous delivery/deployment (CI/CD) from DevOps, orchestrating data pipelines (DataOps) from Data Engineering domain, and model-building from Machine Learning domain to enable efficient and reliable deployment, monitoring, and maintenance of ML systems at scale.</p>
<div style="text-align:center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/ntp3105/IISc-CCE-ML-AI-MLOps/blob/main/Week-1/images/Venn_diagram.PNG?raw=true" class="img-fluid figure-img"></p>
<figcaption>Venn diagram of different domains under data science, and AI</figcaption>
</figure>
</div>
</div>
</section>
<section id="motivation-for-mlops-unlocking-the-potential-of-machine-learning-system" class="level2">
<h2 class="anchored" data-anchor-id="motivation-for-mlops-unlocking-the-potential-of-machine-learning-system">Motivation for MLOps: Unlocking the potential of Machine Learning system</h2>
<p>In the last ten years, machine learning has revolutionised many industries, enabling automation, streamlining processes, and providing insights which has flourished the companies. But as industries has started incorporating machine learning into their operations at a large scale, it has raised many complexities, few of which are how to guarantee that a trained model is deployed in a production environment without any problems? How to manage the lifecycle of numerous models to ensure they remain precise and up-to-date? How to assure the close-knit collaboration between data scientists, data engineers, business managers, software engineers, and other stakeholders to ensure that hand-offs occur efficiently, from data preparation and model training to model deployment and monitoring? Are the machine learning models are effectively offering the best business decisions? MLOps addresses all that and then more.</p>
<div style="text-align:center">
<p><img src="https://cloud.google.com/static/architecture/images/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning-1-elements-of-ml.png" class="img-fluid"> <em><a href="https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning">Image Source: Elements for ML systems</a></em></p>
</div>
<p>Teams at Google have been doing a lot of research on the technical challenges that come with building ML-based systems. A NeurIPS paper on hidden technical Debt in ML systems shows you developing models is just a very small part of the whole process. There are many other processes, configurations, and tools that are to be integrated into the system. To streamline this entire system, we have this new Machine learning engineering culture. The system involves everyone from the higher management with minimal technical skills to Data Scientists to DevOps and ML Engineers.</p>
<div style="text-align:center">
<p><img src="https://www.freecodecamp.org/news/content/images/size/w2000/2021/03/mlops_thumb.png" class="img-fluid"> <em><a href="https://www.freecodecamp.org/news/what-is-mlops-machine-learning-operations-explained/">Image Source: What is MLOps?</a></em></p>
</div>
</section>
<section id="differences-between-traditional-software-systems-and-machine-learning-systems" class="level2">
<h2 class="anchored" data-anchor-id="differences-between-traditional-software-systems-and-machine-learning-systems">Differences Between Traditional Software systems and Machine Learning systems</h2>
<p>In the realm of software development, traditional software systems and Machine Learning (ML) systems differ fundamentally despite some overlaps. They differ in their approach to problem-solving, development process, implemented and managed. Here are some key differences:</p>
<ol type="1">
<li><strong>Problem Scope</strong>:
<ul>
<li><strong>Traditional Software</strong>: The problem, solution, and success metrics are clear from the beginning. For example, creating a marketplace for home rentals has a defined goal and success is a working platform [1].</li>
<li><strong>ML Systems</strong>: The problem and solution may be unclear at the start and can change as the project progresses. Success is often measured by the optimization of model metrics like accuracy or precision [1].</li>
</ul></li>
<li><strong>Quality Dependency</strong>:
<ul>
<li><strong>Traditional Software</strong>: Quality depends on the code. Changes in data do not impact the functionality unless new business rules are needed [2].</li>
<li><strong>ML Systems</strong>: Quality depends on input data and hyperparameter tuning. New data may require retraining the model to maintain or improve performance [2].</li>
</ul></li>
<li><strong>Continuous Evolution</strong>:
<ul>
<li><strong>Traditional Software</strong>: A programmer writes explicit rules or instructions for the computer to follow [3]. Once developed and tested, traditional software typically does not need to evolve unless there is a change in requirements, a need for optimization, or detected bugs. Updates are predictable and often scheduled.</li>
<li><strong>ML Systems</strong>: Algorithms learn from data without explicit programming. Models improve over time with feedback [3]. ML models in ML systems often require continuous updating and retraining. This is due to factors such as evolving data, changing patterns, and the nonstationary nature of many real-world scenarios (i.e., the underlying distribution of the problem changes over time). <em>Example</em>: A model that predicts stock prices will need regular updates due to the dynamic nature of financial markets.</li>
</ul></li>
<li><strong>Data Dependency</strong>:
<ul>
<li><strong>Traditional Software</strong>: Relies less on data and more on predetermined logic [3]. The functionality is mostly independent of external data. While it processes data, its core behavior does not change on the basis of the data it has processed in the past.</li>
<li><strong>ML Systems</strong>: Heavily reliant on data to draw decision logic [4]. The effectiveness of ML models is intrinsically tied to the quality, quantity, and relevance of the training data. An ML model’s behavior is shaped by its past data, making it crucial to ensure high-quality data for training. <em>Example</em>: A chatbot trained on a limited and poor quality dataset might give irrelevant answers, whereas one trained on a diverse and comprehensive dataset can provide more accurate and context-aware responses.</li>
</ul></li>
<li><strong>Validation and Testing</strong>:
<ul>
<li><strong>Traditional Software</strong>: The functionality is mostly independent of external data. While it processes data, its core behavior does not change on the basis of the data it has processed in the past.</li>
<li><strong>ML Systems</strong>: The effectiveness of ML models is intrinsically tied to the quality, quantity, and relevance of the training data. An ML model’s behavior is shaped by its past data, making it crucial to ensure high-quality data for training. <em>Example</em>: A chatbot trained on a limited and poor quality dataset might give irrelevant answers, whereas one trained on a diverse and comprehensive dataset can provide more accurate and context-aware responses.</li>
</ul></li>
<li><strong>Outcome Predictability</strong>:
<ul>
<li><strong>Traditional Software</strong>: Exhibits deterministic behavior with predictable outcomes based on the given input[3]. For a given input, they will always produce the same output, provided the system state and configuration remain unchanged. Their behavior is explicitly programmed, meaning that developers define a set of rules and conditions that dictate the software’s response to various inputs.</li>
<li><strong>ML Systems</strong>: Outcomes are probabilistic and can vary depending on the data it was trained on [3]. They generate outputs based on patterns identified during training. Consequently, they might produce different outcomes for slightly varying inputs, and there is inherent uncertainty in their predictions.</li>
</ul></li>
</ol>
<p>In summary, traditional software operates on a set of clear rules and is less dependent on data, whereas ML systems are designed to learn from data, requiring continuous improvement and adaptation to evolving data. This fundamental difference impacts how problems are defined, how success is measured, and how the systems are developed and maintained.</p>
</section>
<section id="components-of-a-ml-system" class="level2">
<h2 class="anchored" data-anchor-id="components-of-a-ml-system">Components of a ML system</h2>
<p>ML systems are intricate, with many workflows intertwined, many stakeholders collaborating to convert raw data into useful predictions or insights. It is essential to comprehend these components to create and execute reliable ML solutions.</p>
<div style="text-align:center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/ntp3105/Comprehensive-MLOps/blob/main/images/Picture_2.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>The realistic picture of an ML model life cycle</figcaption>
</figure>
</div>
</div>
<div style="text-align:center">
<p><em><a href="https://www.oreilly.com/library/view/what-is-mlops/9781492093626/ch01.html">Image Source: What Is MLOps? by Mark Treveil, Lynn Heidmann</a></em></p>
</div>
<ol type="1">
<li><strong>Data Acquisition:</strong><br>
The process of acquiring data from different sources, importing them, read and make them accessible for further workflows in the ML system. The key aspects are:</li>
</ol>
<ul>
<li><strong>Sources:</strong> Data can be ingested from a variety of sources, including databases, data lakes, APIs, and streaming platforms.</li>
<li><strong>Formats:</strong> Data can come in multiple formats such as CSV, Parquet, JSON, images, and more.</li>
<li><strong>Real-time vs.&nbsp;Batch:</strong> While real-time ingestion processes data as it’s generated, batch ingestion involves processing data at intervals.</li>
</ul>
<ol start="2" type="1">
<li><strong>Data Preparation</strong> At this stage, data from the previous stage is transformed from raw data into a format suitable for training ML models. The key aspects include:</li>
</ol>
<ul>
<li><strong>Cleaning:</strong> Handling missing values, removing outliers, and correcting erroneous data.</li>
<li><strong>Feature Engineering:</strong> Creating new features from existing ones to improve model performance.</li>
<li><strong>Normalization &amp; Scaling:</strong> Adjusting the feature scales to ensure consistent model training.</li>
<li><strong>Encoding:</strong> Converting categorical variables into numerical formats for the model.</li>
<li><strong>Data Augmentation (for image data):</strong> Creating new training samples by applying transformations (e.g., rotation, flipping) to existing images.</li>
</ul>
<ol start="3" type="1">
<li><strong>Model Training</strong> The core process where data is fed into algorithms to develop predictive models. The key aspects include:</li>
</ol>
<ul>
<li><strong>Algorithm Selection:</strong> Choosing the right machine learning or deep learning algorithm for the problem.</li>
<li><strong>Hyperparameter Tuning:</strong> Optimizing model parameters to enhance performance.</li>
<li><strong>Training Loops:</strong> Iteratively updating the model weights based on the prediction error.</li>
<li><strong>Validation:</strong> Using a separate data set to avoid overfitting and ensure the model generalizes well.</li>
</ul>
<ol start="4" type="1">
<li><strong>Model Evaluation</strong> The process of assessing the performance of an ML model.The key aspects include:</li>
</ol>
<ul>
<li><strong>Metrics:</strong> Depending on the problem type, different metrics are used (e.g., accuracy, precision, recall, F1 score for classification; MSE or RMSE for regression).</li>
<li><strong>Confusion Matrix:</strong> A table used to evaluate classification models by comparing actual vs.&nbsp;predicted classes.</li>
<li><strong>Cross-Validation:</strong> A technique where the training set is split multiple times to assess the robustness of the model.</li>
<li><strong>AUC-ROC:</strong> A grpahical representation for the performance of the classification model</li>
</ul>
<ol start="5" type="1">
<li><strong>Model Serving</strong> Deploying trained models to make predictions on new data involves several key aspects:</li>
</ol>
<ul>
<li><strong>Deployment Platforms</strong>: Models can be deployed on various platforms, including cloud services, on-premises servers, and edge devices.</li>
<li><strong>API Endpoints</strong>: Models are exposed as services with API endpoints. These endpoints allow querying the model for predictions.</li>
<li><strong>Batch vs.&nbsp;Real-Time Serving</strong>:
<ul>
<li><strong>Batch Serving</strong>: Provides predictions on bulk data all at once.</li>
<li><strong>Real-Time Serving</strong>: Offers immediate predictions for each input.</li>
</ul></li>
</ul>
<ol start="6" type="1">
<li><strong>Model Monitoring</strong> Continuously observing and analyzing deployed models’ behavior and performance is crucial. Here are the key aspects of model monitoring:</li>
</ol>
<ul>
<li><strong>Performance Monitoring</strong>: Track accuracy, latency, and other relevant metrics after deployment. Ensure the model performs as expected.</li>
<li><strong>Logging</strong>: Keep records of prediction requests, responses, and errors. Useful for debugging and auditing.</li>
<li><strong>Alerts</strong>: Set up automatic notifications for anomalies or performance degradations. Prompt action when issues arise.</li>
<li><strong>Model Drift Detection</strong>: Monitor data distribution over time. Detect changes that may impact model performance.</li>
</ul>
</section>
<section id="key-components-of-mlops" class="level2">
<h2 class="anchored" data-anchor-id="key-components-of-mlops">Key Components of MLOps</h2>
<section id="continuous-integration-continuous-deployment-cicd" class="level3">
<h3 class="anchored" data-anchor-id="continuous-integration-continuous-deployment-cicd">1. Continuous Integration &amp; Continuous Deployment (CI/CD)</h3>
<p>CI/CD pipelines automate the process of building, testing, and deploying ML models. This ensures that changes to models or code are quickly integrated and deployed into production environments.</p>
<p><img src="https://d1.awsstatic.com/product-marketing/AI/CI_CD-Pipeline.f94b9e3b759f4e6d8bfb07dd6511e0bc4e41e8de.png" class="img-fluid" alt="CI/CD"> <em>Image Source: Amazon Web Services</em></p>
</section>
<section id="model-versioning-registry" class="level3">
<h3 class="anchored" data-anchor-id="model-versioning-registry">2. Model Versioning &amp; Registry</h3>
<p>Model versioning and registry systems track and manage different versions of ML models, making it easy to rollback changes if necessary and ensuring reproducibility of experiments.</p>
<p><img src="https://miro.medium.com/max/1558/1*bKFfJbtpCUBb0VJ2R9bdZA.png" class="img-fluid" alt="Model Versioning"> <em>Image Source: Medium</em></p>
</section>
<section id="model-monitoring-observability" class="level3">
<h3 class="anchored" data-anchor-id="model-monitoring-observability">3. Model Monitoring &amp; Observability</h3>
<p>Monitoring and observability tools track the performance of deployed models in real-time, detecting drift, anomalies, and degradation in model accuracy, and triggering alerts for corrective actions.</p>
<p><img src="https://databricks.com/wp-content/uploads/2021/03/Production-Monitoring-1024x499.png" class="img-fluid" alt="Model Monitoring"> <em>Image Source: Databricks</em></p>
<p>Steps in the MLOps process</p>
<p>Where MLOps sees the biggest benefit is in the iterative orchestration of tasks. While data scientists are reviewing new data sources, engineers are adjusting ML configurations. Making simultaneous adjustments in real-time vastly reduces the time spent on improvements.</p>
</section>
</section>
<section id="benefits-of-mlops" class="level2">
<h2 class="anchored" data-anchor-id="benefits-of-mlops">Benefits of MLOps</h2>
<section id="reducing-time-to-market" class="level3">
<h3 class="anchored" data-anchor-id="reducing-time-to-market">Reducing Time-to-Market</h3>
<ul>
<li><p><em><strong>Rapid Prototyping</strong></em>: MLOps allows teams to quickly iterate over models, helping them move from conceptualization to deployment swiftly.</p></li>
<li><p><em><strong>Automation</strong></em>: Automated pipelines reduce manual errors and speed up repetitive tasks like data pre-processing, model validation, and deployment.</p></li>
<li><p><em><strong>Feedback Loops</strong></em>: Faster model training and deployment cycles enable organizations to get faster feedback, aiding in timely model adjustments.</p></li>
</ul>
</section>
<section id="ensuring-model-reliability-and-robustness" class="level3">
<h3 class="anchored" data-anchor-id="ensuring-model-reliability-and-robustness">Ensuring Model Reliability and Robustness</h3>
<ul>
<li><p><em><strong>Reproducibility</strong></em>: MLOps emphasizes versioning not just for code but also for data and model configurations, ensuring that experiments are reproducible.</p></li>
<li><p><em><strong>Continuous Evaluation</strong></em>: With continuous monitoring, models are regularly evaluated against new data to detect and address perfor- mance degradation.</p></li>
<li><p><em><strong>Alert Mechanisms</strong></em>: MLOps tools can raise instant alerts if a model’s performance dips below a threshold or if anomalies are detected, ensuring timely interventions.</p></li>
</ul>
</section>
<section id="simplifying-model-management" class="level3">
<h3 class="anchored" data-anchor-id="simplifying-model-management">Simplifying Model Management</h3>
<ul>
<li><p><em><strong>Centralized Model Registry</strong></em>: MLOps practises often include main- taining a centralised model registry where all models, their ver- sions, and metadata are stored, simplifying model discovery and management.</p></li>
<li><p><em><strong>Rollbacks and Canary Deployments</strong></em>: If a newly deployed model fails, MLOps enables swift rollbacks to the previous stable version. Canary deployments allow one to test new models on a fraction of the traffic before a full-scale rollout.</p></li>
<li><p><em><strong>Scalability</strong></em>: MLOps infrastructure is designed to scale, ensuring that the models can handle varying loads, from a few requests per sec- ond to thousands.</p></li>
</ul>
</section>
<section id="ensuring-regulatory-and-ethical-compliance" class="level3">
<h3 class="anchored" data-anchor-id="ensuring-regulatory-and-ethical-compliance">Ensuring Regulatory and Ethical Compliance</h3>
<ul>
<li><p><em><strong>Audit Trails</strong></em>: MLOps tools log every action, change, and decision made in the ML workflow, enabling traceability and satisfying reg- ulatory requirements.</p></li>
<li><p><em><strong>Bias Detection and Fairness Checks</strong></em>: MLOps emphasises continuous monitoring for biases and unfair decision-making, helping organi- sations uphold ethical standards and avoid reputational risks.</p></li>
<li><p><em><strong>Data Security and Privacy</strong></em>: With the increasing importance of data in ML workflows, MLOps ensures that data are stored, accessed, and used securely, respecting privacy norms and regulations.</p></li>
</ul>
<p>In conclusion, MLOps plays a crucial role in enabling organizations to operationalize and scale their machine learning initiatives effectively. By integrating best practices from software engineering and data science, MLOps fosters collaboration, agility, and reliability in the development and deployment of ML solutions.</p>
</section>
</section>
<section id="how-generative-ai-is-evolving-mlops" class="level2">
<h2 class="anchored" data-anchor-id="how-generative-ai-is-evolving-mlops">How generative AI is evolving MLOps</h2>
<p>The release of OpenAI’s ChatGPT sparked interests in AI capabilities across industries and disciplines. This technology, known as generative AI, has the capability to write software code, create images and produce a variety of data types, as well as further develop the MLOps process [7].</p>
<p>Generative AI is a type of deep-learning model that takes raw data, processes it and “learns” to generate probable outputs. In other words, the AI model uses a simplified representation of the training data to create a new work that’s similar, but not identical, to the original data. For example, by analyzing the language used by Shakespeare, a user can prompt a generative AI model to create a Shakespeare-like sonnet on a given topic to create an entirely new work.</p>
<p>Generative AI relies on foundation models to create a scalable process. As AI has evolved, data scientists have acknowledged that building AI models takes a lot of data, energy and time, from compiling, labeling and processing data sets the models use to “learn” to the energy is takes to process the data and iteratively train the models. Foundation models aim to solve this problem. A foundation model takes a massive quantity of data and using self-supervised learning and transfer learning can take that data to create models for a wide range of tasks [7].</p>
<p>This advancement in AI means that data sets aren’t task specific—the model can apply information it’s learned about one situation to another. Engineers are now using foundation models to create the training models for MLOps processes faster. They simply take the foundation model and fine-tune it using their own data, versus taking their data and building a model from scratch [7].</p>
</section>
<section id="citations" class="level2">
<h2 class="anchored" data-anchor-id="citations">Citations</h2>
<ol type="1">
<li>[What is MLOps? Machine Learning Operations Explained] - Source: <a href="https://www.freecodecamp.org/news/what-is-mlops-machine-learning-operations-explained/">FreeCodeCamp</a></li>
<li>[How machine learning differs from traditional-software] - Source: <a href="https://medium.com/machine-learning-in-practice/how-machine-learning-differs-from-traditional-software-80d0a235ff3b">Medium</a></li>
<li>[difference between machine learning traditional software]- Source: <a href="https://vitalflux.com/difference-between-machine-learning-traditional-software/">vitalflux</a></li>
<li>[Traditional Programming vs Machine Learning]- Source: <a href="https://insightsoftware.com/blog/machine-learning-vs-traditional-programming/">insightsoftware</a></li>
<li>[Test &amp; Evaluation Best Practices for Machine Learning-Enabled Systems]- Source: <a href="https://arxiv.org/pdf/2310.06800">arxiv</a></li>
<li>[Introduction to MLOps]- Source: <a href="https://readmedium.com/en/https:/ogre51.medium.com/introduction-to-mlops-815d03c8a4d4">Medium:ogre51</a></li>
<li>[MLOps and the evolution of data science]- Source: <a href="https://www.ibm.com/blog/mlops-and-the-evolution-of-data-science/">IBM</a></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>